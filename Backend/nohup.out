INFO:     Started server process [135416]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
{"ts":"2025-09-26T13:06:39.741Z","level":"INFO","msg":"GET /health/ 200 1.0ms","logger":"access","request_id":"b6970af8d22d","tenant_id":"-"}
INFO:     127.0.0.1:60042 - "GET /health/ HTTP/1.1" 200 OK
{"ts":"2025-09-26T13:06:52.792Z","level":"INFO","msg":"GET /health/ 200 1.9ms","logger":"access","request_id":"bdd560ac0f3d","tenant_id":"-"}
INFO:     127.0.0.1:40660 - "GET /health/ HTTP/1.1" 200 OK
2025-09-26 13:11:11,887 INFO sqlalchemy.engine.Engine select pg_catalog.version()
{"ts":"2025-09-26T13:11:11.887Z","level":"INFO","msg":"select pg_catalog.version()","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:11:11,887 INFO sqlalchemy.engine.Engine [raw sql] {}
{"ts":"2025-09-26T13:11:11.887Z","level":"INFO","msg":"[raw sql] {}","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:11:11,888 INFO sqlalchemy.engine.Engine select current_schema()
{"ts":"2025-09-26T13:11:11.888Z","level":"INFO","msg":"select current_schema()","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:11:11,888 INFO sqlalchemy.engine.Engine [raw sql] {}
{"ts":"2025-09-26T13:11:11.888Z","level":"INFO","msg":"[raw sql] {}","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:11:11,889 INFO sqlalchemy.engine.Engine show standard_conforming_strings
{"ts":"2025-09-26T13:11:11.889Z","level":"INFO","msg":"show standard_conforming_strings","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:11:11,889 INFO sqlalchemy.engine.Engine [raw sql] {}
{"ts":"2025-09-26T13:11:11.889Z","level":"INFO","msg":"[raw sql] {}","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:11:11,890 INFO sqlalchemy.engine.Engine BEGIN (implicit)
{"ts":"2025-09-26T13:11:11.890Z","level":"INFO","msg":"BEGIN (implicit)","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:11:11,892 INFO sqlalchemy.engine.Engine SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at 
FROM tenants 
WHERE tenants.primary_domain = %(primary_domain_1)s 
 LIMIT %(param_1)s
{"ts":"2025-09-26T13:11:11.892Z","level":"INFO","msg":"SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at \nFROM tenants \nWHERE tenants.primary_domain = %(primary_domain_1)s \n LIMIT %(param_1)s","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:11:11,893 INFO sqlalchemy.engine.Engine [generated in 0.00024s] {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}
{"ts":"2025-09-26T13:11:11.893Z","level":"INFO","msg":"[generated in 0.00024s] {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:11:11,894 INFO sqlalchemy.engine.Engine ROLLBACK
{"ts":"2025-09-26T13:11:11.894Z","level":"INFO","msg":"ROLLBACK","logger":"sqlalchemy.engine.Engine"}
{"ts":"2025-09-26T13:11:11.895Z","level":"INFO","msg":"GET /api/public/tenant-meta 500 54.7ms","logger":"access","request_id":"ff38548926f6c8e67e4b3b6f9f69fd12","tenant_id":"-"}
INFO:     41.116.135.217:0 - "GET /api/public/tenant-meta HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column tenants.subdomain does not exist
LINE 1: ...tenants.primary_domain AS tenants_primary_domain, tenants.su...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 460, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 441, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 382, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 370, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 348, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 267, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 232, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/trustedhost.py", line 36, in __call__
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 29, in __call__
    await responder(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 130, in __call__
    await super().__call__(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 46, in __call__
    await self.app(scope, receive, self.send_with_compression)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/app/plugins/observability/plugin.py", line 91, in _obs_mw
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 215, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2476, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 967, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 657, in public_tenant_meta
    ctx = _resolve_public_tenant(request, db)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 626, in _resolve_public_tenant
    t = db.query(_Tenant).filter_by(primary_domain=h).first()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2759, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column tenants.subdomain does not exist
LINE 1: ...tenants.primary_domain AS tenants_primary_domain, tenants.su...
                                                             ^

[SQL: SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at 
FROM tenants 
WHERE tenants.primary_domain = %(primary_domain_1)s 
 LIMIT %(param_1)s]
[parameters: {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-26 13:11:13,348 INFO sqlalchemy.engine.Engine BEGIN (implicit)
{"ts":"2025-09-26T13:11:13.348Z","level":"INFO","msg":"BEGIN (implicit)","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:11:13,349 INFO sqlalchemy.engine.Engine SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at 
FROM tenants 
WHERE tenants.primary_domain = %(primary_domain_1)s 
 LIMIT %(param_1)s
{"ts":"2025-09-26T13:11:13.349Z","level":"INFO","msg":"SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at \nFROM tenants \nWHERE tenants.primary_domain = %(primary_domain_1)s \n LIMIT %(param_1)s","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:11:13,349 INFO sqlalchemy.engine.Engine [cached since 1.457s ago] {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}
{"ts":"2025-09-26T13:11:13.349Z","level":"INFO","msg":"[cached since 1.457s ago] {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:11:13,350 INFO sqlalchemy.engine.Engine ROLLBACK
{"ts":"2025-09-26T13:11:13.350Z","level":"INFO","msg":"ROLLBACK","logger":"sqlalchemy.engine.Engine"}
{"ts":"2025-09-26T13:11:13.351Z","level":"INFO","msg":"GET /api/public/tenant-meta 500 4.8ms","logger":"access","request_id":"7dfa901bdf31f1c35a6cdbfc997b1532","tenant_id":"-"}
INFO:     41.116.135.217:0 - "GET /api/public/tenant-meta HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column tenants.subdomain does not exist
LINE 1: ...tenants.primary_domain AS tenants_primary_domain, tenants.su...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 460, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 441, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 382, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 370, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 348, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 267, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 232, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/trustedhost.py", line 36, in __call__
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 29, in __call__
    await responder(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 130, in __call__
    await super().__call__(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 46, in __call__
    await self.app(scope, receive, self.send_with_compression)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/app/plugins/observability/plugin.py", line 91, in _obs_mw
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 215, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2476, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 967, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 657, in public_tenant_meta
    ctx = _resolve_public_tenant(request, db)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 626, in _resolve_public_tenant
    t = db.query(_Tenant).filter_by(primary_domain=h).first()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2759, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column tenants.subdomain does not exist
LINE 1: ...tenants.primary_domain AS tenants_primary_domain, tenants.su...
                                                             ^

[SQL: SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at 
FROM tenants 
WHERE tenants.primary_domain = %(primary_domain_1)s 
 LIMIT %(param_1)s]
[parameters: {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-26 13:11:15,792 INFO sqlalchemy.engine.Engine BEGIN (implicit)
{"ts":"2025-09-26T13:11:15.792Z","level":"INFO","msg":"BEGIN (implicit)","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:11:15,792 INFO sqlalchemy.engine.Engine SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at 
FROM tenants 
WHERE tenants.primary_domain = %(primary_domain_1)s 
 LIMIT %(param_1)s
{"ts":"2025-09-26T13:11:15.792Z","level":"INFO","msg":"SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at \nFROM tenants \nWHERE tenants.primary_domain = %(primary_domain_1)s \n LIMIT %(param_1)s","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:11:15,792 INFO sqlalchemy.engine.Engine [cached since 3.9s ago] {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}
{"ts":"2025-09-26T13:11:15.792Z","level":"INFO","msg":"[cached since 3.9s ago] {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:11:15,793 INFO sqlalchemy.engine.Engine ROLLBACK
{"ts":"2025-09-26T13:11:15.793Z","level":"INFO","msg":"ROLLBACK","logger":"sqlalchemy.engine.Engine"}
{"ts":"2025-09-26T13:11:15.794Z","level":"INFO","msg":"GET /api/public/tenant-meta 500 3.8ms","logger":"access","request_id":"2a956a29eed760f87f4800a166708ca6","tenant_id":"-"}
INFO:     41.116.135.217:0 - "GET /api/public/tenant-meta HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column tenants.subdomain does not exist
LINE 1: ...tenants.primary_domain AS tenants_primary_domain, tenants.su...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 460, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 441, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 382, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 370, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 348, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 267, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 232, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/trustedhost.py", line 36, in __call__
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 29, in __call__
    await responder(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 130, in __call__
    await super().__call__(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 46, in __call__
    await self.app(scope, receive, self.send_with_compression)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/app/plugins/observability/plugin.py", line 91, in _obs_mw
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 215, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2476, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 967, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 657, in public_tenant_meta
    ctx = _resolve_public_tenant(request, db)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 626, in _resolve_public_tenant
    t = db.query(_Tenant).filter_by(primary_domain=h).first()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2759, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column tenants.subdomain does not exist
LINE 1: ...tenants.primary_domain AS tenants_primary_domain, tenants.su...
                                                             ^

[SQL: SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at 
FROM tenants 
WHERE tenants.primary_domain = %(primary_domain_1)s 
 LIMIT %(param_1)s]
[parameters: {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-26 13:19:47,957 INFO sqlalchemy.engine.Engine BEGIN (implicit)
{"ts":"2025-09-26T13:19:47.957Z","level":"INFO","msg":"BEGIN (implicit)","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:19:47,957 INFO sqlalchemy.engine.Engine SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at 
FROM tenants 
WHERE tenants.primary_domain = %(primary_domain_1)s 
 LIMIT %(param_1)s
{"ts":"2025-09-26T13:19:47.957Z","level":"INFO","msg":"SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at \nFROM tenants \nWHERE tenants.primary_domain = %(primary_domain_1)s \n LIMIT %(param_1)s","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:19:47,957 INFO sqlalchemy.engine.Engine [cached since 516.1s ago] {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}
{"ts":"2025-09-26T13:19:47.957Z","level":"INFO","msg":"[cached since 516.1s ago] {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:19:47,958 INFO sqlalchemy.engine.Engine ROLLBACK
{"ts":"2025-09-26T13:19:47.958Z","level":"INFO","msg":"ROLLBACK","logger":"sqlalchemy.engine.Engine"}
{"ts":"2025-09-26T13:19:47.959Z","level":"INFO","msg":"GET /api/public/tenant-meta 500 4.0ms","logger":"access","request_id":"e1accb6baf4fd657c0d792a51f54db10","tenant_id":"-"}
INFO:     41.116.135.217:0 - "GET /api/public/tenant-meta HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column tenants.subdomain does not exist
LINE 1: ...tenants.primary_domain AS tenants_primary_domain, tenants.su...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 460, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 441, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 382, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 370, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 348, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 267, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 232, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/trustedhost.py", line 36, in __call__
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 29, in __call__
    await responder(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 130, in __call__
    await super().__call__(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 46, in __call__
    await self.app(scope, receive, self.send_with_compression)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/app/plugins/observability/plugin.py", line 91, in _obs_mw
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 215, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2476, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 967, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 657, in public_tenant_meta
    ctx = _resolve_public_tenant(request, db)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 626, in _resolve_public_tenant
    t = db.query(_Tenant).filter_by(primary_domain=h).first()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2759, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column tenants.subdomain does not exist
LINE 1: ...tenants.primary_domain AS tenants_primary_domain, tenants.su...
                                                             ^

[SQL: SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at 
FROM tenants 
WHERE tenants.primary_domain = %(primary_domain_1)s 
 LIMIT %(param_1)s]
[parameters: {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-26 13:19:49,449 INFO sqlalchemy.engine.Engine BEGIN (implicit)
{"ts":"2025-09-26T13:19:49.449Z","level":"INFO","msg":"BEGIN (implicit)","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:19:49,450 INFO sqlalchemy.engine.Engine SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at 
FROM tenants 
WHERE tenants.primary_domain = %(primary_domain_1)s 
 LIMIT %(param_1)s
{"ts":"2025-09-26T13:19:49.450Z","level":"INFO","msg":"SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at \nFROM tenants \nWHERE tenants.primary_domain = %(primary_domain_1)s \n LIMIT %(param_1)s","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:19:49,450 INFO sqlalchemy.engine.Engine [cached since 517.6s ago] {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}
{"ts":"2025-09-26T13:19:49.450Z","level":"INFO","msg":"[cached since 517.6s ago] {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:19:49,451 INFO sqlalchemy.engine.Engine ROLLBACK
{"ts":"2025-09-26T13:19:49.451Z","level":"INFO","msg":"ROLLBACK","logger":"sqlalchemy.engine.Engine"}
{"ts":"2025-09-26T13:19:49.451Z","level":"INFO","msg":"GET /api/public/tenant-meta 500 4.1ms","logger":"access","request_id":"19f00b1d2e341b232884c00cff0ca17e","tenant_id":"-"}
INFO:     41.116.135.217:0 - "GET /api/public/tenant-meta HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column tenants.subdomain does not exist
LINE 1: ...tenants.primary_domain AS tenants_primary_domain, tenants.su...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 460, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 441, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 382, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 370, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 348, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 267, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 232, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/trustedhost.py", line 36, in __call__
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 29, in __call__
    await responder(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 130, in __call__
    await super().__call__(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 46, in __call__
    await self.app(scope, receive, self.send_with_compression)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/app/plugins/observability/plugin.py", line 91, in _obs_mw
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 215, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2476, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 967, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 657, in public_tenant_meta
    ctx = _resolve_public_tenant(request, db)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 626, in _resolve_public_tenant
    t = db.query(_Tenant).filter_by(primary_domain=h).first()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2759, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column tenants.subdomain does not exist
LINE 1: ...tenants.primary_domain AS tenants_primary_domain, tenants.su...
                                                             ^

[SQL: SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at 
FROM tenants 
WHERE tenants.primary_domain = %(primary_domain_1)s 
 LIMIT %(param_1)s]
[parameters: {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-26 13:19:51,912 INFO sqlalchemy.engine.Engine BEGIN (implicit)
{"ts":"2025-09-26T13:19:51.912Z","level":"INFO","msg":"BEGIN (implicit)","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:19:51,912 INFO sqlalchemy.engine.Engine SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at 
FROM tenants 
WHERE tenants.primary_domain = %(primary_domain_1)s 
 LIMIT %(param_1)s
{"ts":"2025-09-26T13:19:51.912Z","level":"INFO","msg":"SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at \nFROM tenants \nWHERE tenants.primary_domain = %(primary_domain_1)s \n LIMIT %(param_1)s","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:19:51,913 INFO sqlalchemy.engine.Engine [cached since 520s ago] {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}
{"ts":"2025-09-26T13:19:51.913Z","level":"INFO","msg":"[cached since 520s ago] {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:19:51,913 INFO sqlalchemy.engine.Engine ROLLBACK
{"ts":"2025-09-26T13:19:51.913Z","level":"INFO","msg":"ROLLBACK","logger":"sqlalchemy.engine.Engine"}
{"ts":"2025-09-26T13:19:51.914Z","level":"INFO","msg":"GET /api/public/tenant-meta 500 4.1ms","logger":"access","request_id":"aa1df3c21e36dbb4ea746b65f56201c9","tenant_id":"-"}
INFO:     41.116.135.217:0 - "GET /api/public/tenant-meta HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column tenants.subdomain does not exist
LINE 1: ...tenants.primary_domain AS tenants_primary_domain, tenants.su...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 460, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 441, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 382, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 370, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 348, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 267, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 232, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/trustedhost.py", line 36, in __call__
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 29, in __call__
    await responder(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 130, in __call__
    await super().__call__(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 46, in __call__
    await self.app(scope, receive, self.send_with_compression)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/app/plugins/observability/plugin.py", line 91, in _obs_mw
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 215, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2476, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 967, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 657, in public_tenant_meta
    ctx = _resolve_public_tenant(request, db)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 626, in _resolve_public_tenant
    t = db.query(_Tenant).filter_by(primary_domain=h).first()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2759, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column tenants.subdomain does not exist
LINE 1: ...tenants.primary_domain AS tenants_primary_domain, tenants.su...
                                                             ^

[SQL: SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at 
FROM tenants 
WHERE tenants.primary_domain = %(primary_domain_1)s 
 LIMIT %(param_1)s]
[parameters: {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-26 13:22:20,707 INFO sqlalchemy.engine.Engine BEGIN (implicit)
{"ts":"2025-09-26T13:22:20.707Z","level":"INFO","msg":"BEGIN (implicit)","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:22:20,708 INFO sqlalchemy.engine.Engine SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at 
FROM tenants 
WHERE tenants.primary_domain = %(primary_domain_1)s 
 LIMIT %(param_1)s
{"ts":"2025-09-26T13:22:20.708Z","level":"INFO","msg":"SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at \nFROM tenants \nWHERE tenants.primary_domain = %(primary_domain_1)s \n LIMIT %(param_1)s","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:22:20,708 INFO sqlalchemy.engine.Engine [cached since 668.8s ago] {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}
{"ts":"2025-09-26T13:22:20.708Z","level":"INFO","msg":"[cached since 668.8s ago] {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:22:20,708 INFO sqlalchemy.engine.Engine ROLLBACK
{"ts":"2025-09-26T13:22:20.708Z","level":"INFO","msg":"ROLLBACK","logger":"sqlalchemy.engine.Engine"}
{"ts":"2025-09-26T13:22:20.709Z","level":"INFO","msg":"GET /api/public/tenant-meta 500 3.7ms","logger":"access","request_id":"a2462bde57b9168be89c139611085cdd","tenant_id":"-"}
INFO:     41.116.135.217:0 - "GET /api/public/tenant-meta HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column tenants.subdomain does not exist
LINE 1: ...tenants.primary_domain AS tenants_primary_domain, tenants.su...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 460, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 441, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 382, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 370, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 348, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 267, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 232, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/trustedhost.py", line 36, in __call__
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 29, in __call__
    await responder(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 130, in __call__
    await super().__call__(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 46, in __call__
    await self.app(scope, receive, self.send_with_compression)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/app/plugins/observability/plugin.py", line 91, in _obs_mw
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 215, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2476, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 967, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 657, in public_tenant_meta
    ctx = _resolve_public_tenant(request, db)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 626, in _resolve_public_tenant
    t = db.query(_Tenant).filter_by(primary_domain=h).first()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2759, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column tenants.subdomain does not exist
LINE 1: ...tenants.primary_domain AS tenants_primary_domain, tenants.su...
                                                             ^

[SQL: SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at 
FROM tenants 
WHERE tenants.primary_domain = %(primary_domain_1)s 
 LIMIT %(param_1)s]
[parameters: {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-26 13:22:22,196 INFO sqlalchemy.engine.Engine BEGIN (implicit)
{"ts":"2025-09-26T13:22:22.196Z","level":"INFO","msg":"BEGIN (implicit)","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:22:22,196 INFO sqlalchemy.engine.Engine SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at 
FROM tenants 
WHERE tenants.primary_domain = %(primary_domain_1)s 
 LIMIT %(param_1)s
{"ts":"2025-09-26T13:22:22.196Z","level":"INFO","msg":"SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at \nFROM tenants \nWHERE tenants.primary_domain = %(primary_domain_1)s \n LIMIT %(param_1)s","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:22:22,197 INFO sqlalchemy.engine.Engine [cached since 670.3s ago] {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}
{"ts":"2025-09-26T13:22:22.197Z","level":"INFO","msg":"[cached since 670.3s ago] {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:22:22,197 INFO sqlalchemy.engine.Engine ROLLBACK
{"ts":"2025-09-26T13:22:22.197Z","level":"INFO","msg":"ROLLBACK","logger":"sqlalchemy.engine.Engine"}
{"ts":"2025-09-26T13:22:22.198Z","level":"INFO","msg":"GET /api/public/tenant-meta 500 3.4ms","logger":"access","request_id":"2d89700eb3455b966256a3c16464f98a","tenant_id":"-"}
INFO:     41.116.135.217:0 - "GET /api/public/tenant-meta HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column tenants.subdomain does not exist
LINE 1: ...tenants.primary_domain AS tenants_primary_domain, tenants.su...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 460, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 441, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 382, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 370, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 348, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 267, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 232, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/trustedhost.py", line 36, in __call__
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 29, in __call__
    await responder(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 130, in __call__
    await super().__call__(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 46, in __call__
    await self.app(scope, receive, self.send_with_compression)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/app/plugins/observability/plugin.py", line 91, in _obs_mw
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 215, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2476, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 967, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 657, in public_tenant_meta
    ctx = _resolve_public_tenant(request, db)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 626, in _resolve_public_tenant
    t = db.query(_Tenant).filter_by(primary_domain=h).first()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2759, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column tenants.subdomain does not exist
LINE 1: ...tenants.primary_domain AS tenants_primary_domain, tenants.su...
                                                             ^

[SQL: SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at 
FROM tenants 
WHERE tenants.primary_domain = %(primary_domain_1)s 
 LIMIT %(param_1)s]
[parameters: {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-26 13:22:24,726 INFO sqlalchemy.engine.Engine BEGIN (implicit)
{"ts":"2025-09-26T13:22:24.726Z","level":"INFO","msg":"BEGIN (implicit)","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:22:24,726 INFO sqlalchemy.engine.Engine SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at 
FROM tenants 
WHERE tenants.primary_domain = %(primary_domain_1)s 
 LIMIT %(param_1)s
{"ts":"2025-09-26T13:22:24.726Z","level":"INFO","msg":"SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at \nFROM tenants \nWHERE tenants.primary_domain = %(primary_domain_1)s \n LIMIT %(param_1)s","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:22:24,726 INFO sqlalchemy.engine.Engine [cached since 672.8s ago] {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}
{"ts":"2025-09-26T13:22:24.726Z","level":"INFO","msg":"[cached since 672.8s ago] {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:22:24,727 INFO sqlalchemy.engine.Engine ROLLBACK
{"ts":"2025-09-26T13:22:24.727Z","level":"INFO","msg":"ROLLBACK","logger":"sqlalchemy.engine.Engine"}
{"ts":"2025-09-26T13:22:24.728Z","level":"INFO","msg":"GET /api/public/tenant-theme 500 3.9ms","logger":"access","request_id":"0d2dc4da2826d2ae4a6942ba472073ef","tenant_id":"-"}
INFO:     41.116.135.217:0 - "GET /api/public/tenant-theme HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column tenants.subdomain does not exist
LINE 1: ...tenants.primary_domain AS tenants_primary_domain, tenants.su...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 460, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 441, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 382, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 370, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 348, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 267, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 232, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/trustedhost.py", line 36, in __call__
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 29, in __call__
    await responder(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 130, in __call__
    await super().__call__(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 46, in __call__
    await self.app(scope, receive, self.send_with_compression)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/app/plugins/observability/plugin.py", line 91, in _obs_mw
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 215, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2476, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 967, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 693, in public_tenant_theme
    ctx = _resolve_public_tenant(request, db)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 626, in _resolve_public_tenant
    t = db.query(_Tenant).filter_by(primary_domain=h).first()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2759, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column tenants.subdomain does not exist
LINE 1: ...tenants.primary_domain AS tenants_primary_domain, tenants.su...
                                                             ^

[SQL: SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at 
FROM tenants 
WHERE tenants.primary_domain = %(primary_domain_1)s 
 LIMIT %(param_1)s]
[parameters: {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-26 13:22:25,289 INFO sqlalchemy.engine.Engine BEGIN (implicit)
{"ts":"2025-09-26T13:22:25.289Z","level":"INFO","msg":"BEGIN (implicit)","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:22:25,289 INFO sqlalchemy.engine.Engine SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at 
FROM tenants 
WHERE tenants.primary_domain = %(primary_domain_1)s 
 LIMIT %(param_1)s
{"ts":"2025-09-26T13:22:25.289Z","level":"INFO","msg":"SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at \nFROM tenants \nWHERE tenants.primary_domain = %(primary_domain_1)s \n LIMIT %(param_1)s","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:22:25,289 INFO sqlalchemy.engine.Engine [cached since 673.4s ago] {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}
{"ts":"2025-09-26T13:22:25.289Z","level":"INFO","msg":"[cached since 673.4s ago] {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:22:25,290 INFO sqlalchemy.engine.Engine ROLLBACK
{"ts":"2025-09-26T13:22:25.290Z","level":"INFO","msg":"ROLLBACK","logger":"sqlalchemy.engine.Engine"}
{"ts":"2025-09-26T13:22:25.291Z","level":"INFO","msg":"GET /api/public/tenant-theme 500 6.1ms","logger":"access","request_id":"23080756fe538f01ca82696479890eea","tenant_id":"-"}
INFO:     41.116.135.217:0 - "GET /api/public/tenant-theme HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column tenants.subdomain does not exist
LINE 1: ...tenants.primary_domain AS tenants_primary_domain, tenants.su...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 460, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 441, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 382, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 370, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 348, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 267, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 232, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/trustedhost.py", line 36, in __call__
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 29, in __call__
    await responder(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 130, in __call__
    await super().__call__(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 46, in __call__
    await self.app(scope, receive, self.send_with_compression)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/app/plugins/observability/plugin.py", line 91, in _obs_mw
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 215, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2476, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 967, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 693, in public_tenant_theme
    ctx = _resolve_public_tenant(request, db)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 626, in _resolve_public_tenant
    t = db.query(_Tenant).filter_by(primary_domain=h).first()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2759, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column tenants.subdomain does not exist
LINE 1: ...tenants.primary_domain AS tenants_primary_domain, tenants.su...
                                                             ^

[SQL: SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at 
FROM tenants 
WHERE tenants.primary_domain = %(primary_domain_1)s 
 LIMIT %(param_1)s]
[parameters: {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-5173.app.github.dev', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-26 13:25:15,829 INFO sqlalchemy.engine.Engine BEGIN (implicit)
{"ts":"2025-09-26T13:25:15.829Z","level":"INFO","msg":"BEGIN (implicit)","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:25:15,830 INFO sqlalchemy.engine.Engine SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at 
FROM tenants 
WHERE tenants.primary_domain = %(primary_domain_1)s 
 LIMIT %(param_1)s
{"ts":"2025-09-26T13:25:15.830Z","level":"INFO","msg":"SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at \nFROM tenants \nWHERE tenants.primary_domain = %(primary_domain_1)s \n LIMIT %(param_1)s","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:25:15,830 INFO sqlalchemy.engine.Engine [cached since 843.9s ago] {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-3000.app.github.dev', 'param_1': 1}
{"ts":"2025-09-26T13:25:15.830Z","level":"INFO","msg":"[cached since 843.9s ago] {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-3000.app.github.dev', 'param_1': 1}","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:25:15,831 INFO sqlalchemy.engine.Engine ROLLBACK
{"ts":"2025-09-26T13:25:15.831Z","level":"INFO","msg":"ROLLBACK","logger":"sqlalchemy.engine.Engine"}
{"ts":"2025-09-26T13:25:15.832Z","level":"INFO","msg":"GET /api/public/tenant-meta 500 3.9ms","logger":"access","request_id":"8942df4bf3c6a8d4498adc50082b9800","tenant_id":"-"}
INFO:     41.116.135.217:0 - "GET /api/public/tenant-meta HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column tenants.subdomain does not exist
LINE 1: ...tenants.primary_domain AS tenants_primary_domain, tenants.su...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 460, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 441, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 382, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 370, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 348, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 267, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 232, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/trustedhost.py", line 36, in __call__
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 29, in __call__
    await responder(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 130, in __call__
    await super().__call__(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 46, in __call__
    await self.app(scope, receive, self.send_with_compression)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/app/plugins/observability/plugin.py", line 91, in _obs_mw
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 215, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2476, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 967, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 657, in public_tenant_meta
    ctx = _resolve_public_tenant(request, db)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 626, in _resolve_public_tenant
    t = db.query(_Tenant).filter_by(primary_domain=h).first()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2759, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column tenants.subdomain does not exist
LINE 1: ...tenants.primary_domain AS tenants_primary_domain, tenants.su...
                                                             ^

[SQL: SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at 
FROM tenants 
WHERE tenants.primary_domain = %(primary_domain_1)s 
 LIMIT %(param_1)s]
[parameters: {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-3000.app.github.dev', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-26 13:25:17,265 INFO sqlalchemy.engine.Engine BEGIN (implicit)
{"ts":"2025-09-26T13:25:17.265Z","level":"INFO","msg":"BEGIN (implicit)","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:25:17,266 INFO sqlalchemy.engine.Engine SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at 
FROM tenants 
WHERE tenants.primary_domain = %(primary_domain_1)s 
 LIMIT %(param_1)s
{"ts":"2025-09-26T13:25:17.266Z","level":"INFO","msg":"SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at \nFROM tenants \nWHERE tenants.primary_domain = %(primary_domain_1)s \n LIMIT %(param_1)s","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:25:17,266 INFO sqlalchemy.engine.Engine [cached since 845.4s ago] {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-3000.app.github.dev', 'param_1': 1}
{"ts":"2025-09-26T13:25:17.266Z","level":"INFO","msg":"[cached since 845.4s ago] {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-3000.app.github.dev', 'param_1': 1}","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:25:17,267 INFO sqlalchemy.engine.Engine ROLLBACK
{"ts":"2025-09-26T13:25:17.267Z","level":"INFO","msg":"ROLLBACK","logger":"sqlalchemy.engine.Engine"}
{"ts":"2025-09-26T13:25:17.267Z","level":"INFO","msg":"GET /api/public/tenant-meta 500 3.7ms","logger":"access","request_id":"f42116cca4057bd3ea050cff4b6dfbdb","tenant_id":"-"}
INFO:     41.116.135.217:0 - "GET /api/public/tenant-meta HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column tenants.subdomain does not exist
LINE 1: ...tenants.primary_domain AS tenants_primary_domain, tenants.su...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 460, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 441, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 382, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 370, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 348, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 267, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 232, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/trustedhost.py", line 36, in __call__
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 29, in __call__
    await responder(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 130, in __call__
    await super().__call__(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 46, in __call__
    await self.app(scope, receive, self.send_with_compression)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/app/plugins/observability/plugin.py", line 91, in _obs_mw
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 215, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2476, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 967, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 657, in public_tenant_meta
    ctx = _resolve_public_tenant(request, db)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 626, in _resolve_public_tenant
    t = db.query(_Tenant).filter_by(primary_domain=h).first()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2759, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column tenants.subdomain does not exist
LINE 1: ...tenants.primary_domain AS tenants_primary_domain, tenants.su...
                                                             ^

[SQL: SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at 
FROM tenants 
WHERE tenants.primary_domain = %(primary_domain_1)s 
 LIMIT %(param_1)s]
[parameters: {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-3000.app.github.dev', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-26 13:25:19,776 INFO sqlalchemy.engine.Engine BEGIN (implicit)
{"ts":"2025-09-26T13:25:19.776Z","level":"INFO","msg":"BEGIN (implicit)","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:25:19,776 INFO sqlalchemy.engine.Engine SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at 
FROM tenants 
WHERE tenants.primary_domain = %(primary_domain_1)s 
 LIMIT %(param_1)s
{"ts":"2025-09-26T13:25:19.776Z","level":"INFO","msg":"SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at \nFROM tenants \nWHERE tenants.primary_domain = %(primary_domain_1)s \n LIMIT %(param_1)s","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:25:19,776 INFO sqlalchemy.engine.Engine [cached since 847.9s ago] {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-3000.app.github.dev', 'param_1': 1}
{"ts":"2025-09-26T13:25:19.776Z","level":"INFO","msg":"[cached since 847.9s ago] {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-3000.app.github.dev', 'param_1': 1}","logger":"sqlalchemy.engine.Engine"}
2025-09-26 13:25:19,777 INFO sqlalchemy.engine.Engine ROLLBACK
{"ts":"2025-09-26T13:25:19.777Z","level":"INFO","msg":"ROLLBACK","logger":"sqlalchemy.engine.Engine"}
{"ts":"2025-09-26T13:25:19.777Z","level":"INFO","msg":"GET /api/public/tenant-meta 500 3.6ms","logger":"access","request_id":"56e0c79a92d2950ccd3c20ce80ef0378","tenant_id":"-"}
INFO:     41.116.135.217:0 - "GET /api/public/tenant-meta HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column tenants.subdomain does not exist
LINE 1: ...tenants.primary_domain AS tenants_primary_domain, tenants.su...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 460, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 441, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 382, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 370, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 348, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 267, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 232, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/trustedhost.py", line 36, in __call__
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 29, in __call__
    await responder(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 130, in __call__
    await super().__call__(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/gzip.py", line 46, in __call__
    await self.app(scope, receive, self.send_with_compression)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/home/codespace/.python/current/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/app/plugins/observability/plugin.py", line 91, in _obs_mw
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 215, in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2476, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 967, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 657, in public_tenant_meta
    ctx = _resolve_public_tenant(request, db)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/main.py", line 626, in _resolve_public_tenant
    t = db.query(_Tenant).filter_by(primary_domain=h).first()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2759, in first
    return self.limit(1)._iter().first()  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/workspaces/SMB-Loyalty-Program/Backend/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column tenants.subdomain does not exist
LINE 1: ...tenants.primary_domain AS tenants_primary_domain, tenants.su...
                                                             ^

[SQL: SELECT tenants.id AS tenants_id, tenants.name AS tenants_name, tenants.loyalty_type AS tenants_loyalty_type, tenants.vertical_type AS tenants_vertical_type, tenants.primary_domain AS tenants_primary_domain, tenants.subdomain AS tenants_subdomain, tenants.logo_url AS tenants_logo_url, tenants.theme_color AS tenants_theme_color, tenants.config AS tenants_config, tenants.created_at AS tenants_created_at 
FROM tenants 
WHERE tenants.primary_domain = %(primary_domain_1)s 
 LIMIT %(param_1)s]
[parameters: {'primary_domain_1': 'laughing-space-trout-pgv46w7pw97h7vv-3000.app.github.dev', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/f405)
