# Change Summary â€” 2025-09-18

This change set focuses on eliminating redirect/429 loops, strengthening middleware, improving observability, stabilizing tests, and pruning CI/CD to Azure-only.

## Backend middleware and stability

- Proxy-aware headers enabled early to honor Forwarded/X-Forwarded-* and prevent HTTPS redirect loops behind proxies.
- Conditional HTTPS redirect (production only) with health endpoints exempt, using the effective scheme to avoid loops.
- Client IP normalization middleware (X-Forwarded-For) prior to rate limiting.
- Global per-IP rate limiter with Retry-After header and exclusions for health/static/docs/openapi/root.
- Request ID injection, timing header, structured access logs, security headers, and GZip added/validated.
- Public tenant meta endpoint includes its own small per-IP rate limit.

## Multitenancy and observability

- Tenant resolution normalized via headers; request.state.tenant_id propagated for logs.
- Observability plugin mounted with diagnostic routes; most hidden from OpenAPI for stability.

## API surface and docs

- OpenAPI at `/api/openapi.json`; Swagger UI available.
- Health metrics endpoint always present in schema (returns disabled payload when metrics are off).

## Testing

- Fixed test contamination around loyalty and vehicle tables; cleared dependent tables in correct order.
- Regenerated OpenAPI snapshot and ensured snapshot tests pass.
- Full backend test suite green locally.

## CI/CD cleanup

- Pruned legacy/unused workflows; retained Azure-focused pipelines.
- Added contributor documentation for workflows: see `.github/WORKFLOWS.md`.

## Notes

- No server runs are required to validate these changes (tests suffice).
- Optional follow-ups: standardize workflow concurrency/permissions; add CodeQL and secret scanning.
